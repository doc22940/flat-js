var flat;!function(){if(void 0!==flat)throw new Error("flat-js: 'flat' module already loaded");flat=function(){var pub={},priv={},toType=function(obj){return{}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};pub.baseUrl="/flat",pub.base_url=pub.baseUrl;var data_storage;try{storage.setItem(testKey,"1"),storage.removeItem(testKey),data_storage=sessionStorage}catch(error){data_storage=null}data_storage||(data_storage=function(){var setCookie=function(ckey,cvalue){var cname="sessionStorageShim/"+ckey,d=new Date;d.setTime(d.getTime()+31536e6);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"},getCookie=function(ckey){for(var cname="sessionStorageShim/"+ckey,name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""},shim={};return shim.getItem=function(skey){if(!pub.isString(skey))throw new error("storage key: must be string");return getCookie(skey)},shim.setItem=function(skey,sval){if(!pub.isString(skey))throw new error("storage key: must be string");if(!pub.isString(sval))throw new error("storage value: must be string");return setCookie(skey,sval)},shim}());var isTouchDevice=null,click={touch:"touchend",mouse:"click"};pub.set_click=function(touch,mouse){click.touch=touch,click.mouse=mouse},pub.set_click=pub.setClick,pub.setTouchOn=function(click_event){void 0!==click_event&&(click.touch=click_event),isTouchDevice=!0},pub.setTouchOff=function(){isTouchDevice=!1},pub.isTouch=function(){return null===isTouchDevice&&(isTouchDevice="ontouchstart"in document.documentElement),isTouchDevice},pub.is_touch=pub.isTouch,pub.ucwords=function(str){return(str+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})},pub.click_event=function(){return pub.is_touch()?click.touch:click.mouse},pub.q=function(selector){return document.querySelector(selector)},pub.getUrl=function(request,router_arg){var router=router_arg;if(void 0===router?router="flat.php":router||(router=""),request)return pub.base_url+"/"+router+"/"+request;var url=pub.base_url+"/"+router+"/";if(console.log("url..."),console.debug(url),document&&document.URL&&(url=document.URL),!url)throw"could not get url";return url},pub.get_url=pub.getUrl,pub.getDebugOn=function(){return!0},pub.get_debug_on=pub.getDebugOn,pub.isObject=function(val){return null!==val&&"object"==typeof val},pub.is_object=pub.isObject,pub.isFunc=function(val){return"function"==typeof val},pub.is_func=pub.isFunc,pub.is_function=pub.isFunc,pub.isFunction=pub.isFunc,pub.isInt=function(val){return!(!val&&0!==val)&&(void 0!==val&&null!==val&&val%1==0)},pub.is_int=pub.isInt,pub.isInteger=pub.isInt,pub.isNumeric=function(n){return!isNaN(parseFloat(n))&&isFinite(n)},pub.isString=function(val){return"string"==typeof val||val instanceof String},pub.is_string=pub.isString,pub.isArray=function(val){return!(!pub.is_object(val)||val.constructor!==Array)},pub.is_array=pub.isArray,pub.data=function(key,val_arg){var json,val=val_arg;if(!key)throw"must provide key";if(!pub.isString(key))throw"key must be string";var fullkey="flat/"+key;if(void 0===val){if(null===(val=data_storage.getItem(fullkey)))return null;try{if(json=JSON.parse(val))return json}catch(error){return console.log("json error..."),console.debug(val),null}if(json===!1)return!1;if(null===json)return null;throw"invalid json for key '"+key+"'"}return data_storage.setItem(fullkey,JSON.stringify(val))},pub.debug=function(data,label_arg){var label=label_arg;if(pub.isString(label)||(label=""),console&&console.debug&&console.log){if("string"==toType(data))return label&&(label="debug ("+label+")"),label||(label="debug"),void console.log(label+": '"+data+"'");label||(label="dump"),console.log("---(start "+toType(data)+") "+label+":"),console.debug(data),console.log("---caller:"),console.log("---(end "+toType(data)+")---")}};var params=null,plist=[];priv.parseQueryString=function(){if(!params){params={};var qs,queryString=null,url=window.location.href.split("?");if(url&&url[1]&&(qs=url[1].split("#"),qs[0]&&(queryString=qs[0])),!queryString)return!1;var queries,kv,i,l;for(queries=queryString.split("&"),i=0,l=queries.length;i<l;i++)kv=queries[i].split("="),params[kv[0]]=decodeURIComponent(kv[1]);for(var p in params)plist.push(p)}},pub.urlQueryString=function(){priv.parseQueryString(),q=[];for(var p in params)q.push(encodeURIComponent(p)+"="+encodeURIComponent(params[p]));return q.join("&")},pub.urlQueryExists=function(key){return priv.parseQueryString(),plist.indexOf(key)!=-1},pub.urlQuery_keyexists=pub.urlQueryExists,pub.urlQueryTruthy=function(key){return!(!pub.urlQuery_keyexists(key)||void 0===params[key]||"false"==params[key]||"no"==params[key]||"off"==params[key]||"0"==params[key])},pub.urlQuery_keytruthy=pub.urlQueryTruthy,pub.urlQueryVal=function(key){if(priv.parseQueryString(),params[key])return params[key]},pub.urlQuery_val=pub.urlQueryVal,pub.urlQuerySet=function(key,val){if(priv.parseQueryString(),void 0!==val&&null!==val)params[key]=val,plist.indexOf(key)==-1&&plist.push(key);else{var kidx=plist.indexOf(key);kidx!=-1&&(delete params[key],plist.splice(kidx,1))}var url=window.location.pathname;plist.length>0&&(url=url+"?"+pub.urlQueryString()),window.history.pushState(null,null,url)},pub.urlQuery_set=pub.urlQuerySet,pub.rand=function(min_arg,max_arg){var min=min_arg,max=max_arg;(void 0===min||min<0)&&(min=0),(void 0===max||max>999999)&&(max=999999);var rand=Math.random().toString().replace(".","").substr(0,6);return(rand=parseInt(rand))*max+min};var makeCRCTable=function(){for(var c,crcTable=[],n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;crcTable[n]=c}return crcTable},crcTable=null,crc32=function(str){crcTable||(crcTable=makeCRCTable());for(var crc=-1,i=0;i<str.length;i++)crc=crc>>>8^crcTable[255&(crc^str.charCodeAt(i))];return(crc^-1)>>>0};pub.crc32=function(str){return crc32(str)};for(var lut=[],il=0;il<256;il++)lut[il]=(il<16?"0":"")+il.toString(16);pub.uuid=function(){var d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return lut[255&d0]+lut[d0>>8&255]+lut[d0>>16&255]+lut[d0>>24&255]+"-"+lut[255&d1]+lut[d1>>8&255]+"-"+lut[d1>>16&15|64]+lut[d1>>24&255]+"-"+lut[63&d2|128]+lut[d2>>8&255]+"-"+lut[d2>>16&255]+lut[d2>>24&255]+lut[255&d3]+lut[d3>>8&255]+lut[d3>>16&255]+lut[d3>>24&255]};var moduleMap={},moduleList=[],moduleReady=[],readyQueue={},readyCallback={};priv.procReadyQueue=!1,priv.procReadyQueueUuuid=null,priv.cleanReadyGarbage=!1,priv.cleanReadyGarbageUuid=null;return pub.ready=function(moduleName,callback){if(!moduleName||!flat.isString(moduleName))throw new Error("flat-js: invalid moduleName");if(!pub.isFunc(callback))throw new Error("flat-js: invalid callback");flat.isArray(readyQueue[moduleName])||(readyQueue[moduleName]=[]),setTimeout(function(){var itemUuid=pub.uuid();return readyCallback[itemUuid]={moduleName:moduleName,created:+new Date,callback:callback,status:!1,runtime:null},moduleList.indexOf(moduleName)==-1?void readyQueue[moduleName].push(itemUuid):moduleList.indexOf(moduleName)==-1?void readyQueue[moduleName].push(itemUuid):void 0},1)},pub.load=function(moduleName,module){if(!moduleName||!flat.isString(moduleName))throw new Error("flat-js: invalid moduleName");if(moduleList.indexOf(moduleName)==-1){if(!flat.isObject(module)&&!flat.isFunction(module))throw new Error("flat-js: invalid module");moduleList.push(moduleName),moduleMap[moduleName]=module,void 0===flat[moduleName]&&(flat[moduleName]=moduleMap[moduleName]),moduleReady.push(moduleName)}},pub}()}();
